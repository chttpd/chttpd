cmake_minimum_required(VERSION 3.7)
project(chttpd 
    VERSION 1.0.0
    LANGUAGES C
)


# verbosity
set(CMAKE_VERBOSE_MAKEFILE OFF)


# project configuration
include(config.cmake)


# public include directory
include_directories(
  ${CMAKE_SOURCE_DIR}/include
  ${CMAKE_SOURCE_DIR}/chttpd
  ${CMAKE_BINARY_DIR}/chttpd
)
configure_file(
  chttpd/config.h.in 
  chttpd/config.h
  @ONLY
)


# cmake libs
include(cmake/build.cmake)
include(cmake/menu.cmake)
include(cmake/lint.cmake)
include(cmake/valgrind.cmake)
include(cmake/cpack.cmake)
include(cmake/uninstall.cmake)


# core tunneling and networking
add_subdirectory(chttpd)


install(TARGETS chttpd DESTINATION "lib")
install(FILES 
  ${PROJECT_SOURCE_DIR}/include/chttpd/chttpd.h 
  DESTINATION "include/chttpd"
)


# examples
add_subdirectory(examples)


# test
enable_testing()
add_subdirectory(tests)
list(APPEND CMAKE_CTEST_ARGUMENTS "--output-on-failure")
